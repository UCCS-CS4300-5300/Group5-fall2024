{% extends "home/base_template.html" %}
{% load static %}


{% block splashscreen %}
<div id="splash" class="splash-screen">
    <h1 class="splash-logo">ChitChatty ٩( ᐛ)و</h1>
</div>

<!-- JavaScript to hide the splash screen after a delay -->
<script>
    window.addEventListener("load", function () {
        setTimeout(function () {
            // Start the fade-out effect by adding the splash-hidden class
            const splash = document.getElementById("splash");
            const logo = document.querySelector(".splash-logo");
            splash.classList.add("splash-hidden");

            // Grow and fade out the logo
            logo.style.transform = "scale(1.2)"; // Grow effect
            setTimeout(function () {
                splash.style.display = "none"; // Remove splash screen
            }, 1000); // Delay matches the splash fade-out duration
        }, 1000);  // Delay before starting the splash screen fade-out (1000ms = 1 second)
    });
</script>
{% endblock splashscreen %}

{% block navbar %}
<!-- Navbar Content -->
<nav class="navbar navbar-light floating-navbar" id="navbar">
    <div class="container-fluid d-flex justify-content-between align-items-center">

        <!-- Left Hand Side -->
        <div class="d-flex align-items-center">

        <!-- Flag Dropdown -->
        <div class="dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <!-- Add ID to target the main flag image -->
                <img id="currentFlag" src="{% static 'home/images/chinese.png' %}" width="55" height="45" alt="Current flag" style="border-radius: 10px;">
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <!-- Language options with data attributes for JavaScript -->
                <li>
                    <a class="dropdown-item" href="#" data-flag="{% static 'home/images/chinese.png' %}" data-lang="Chinese">
                        <img src="{% static 'home/images/chinese.png' %}" width="50" height="40" style="border-radius: 5px;">
                        Chinese
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" data-flag="{% static 'home/images/netherlands.png' %}" data-lang="Dutch">
                        <img src="{% static 'home/images/netherlands.png' %}" width="50" height="40" style="border-radius: 5px;">
                        Dutch
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" data-flag="{% static 'home/images/french.png' %}" data-lang="French">
                        <img src="{% static 'home/images/french.png' %}" width="50" height="40" style="border-radius: 5px;">
                        French
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" data-flag="{% static 'home/images/japanese.png' %}" data-lang="Japanese">
                        <img src="{% static 'home/images/japanese.png' %}" width="50" height="40" style="border-radius: 5px;">
                        Japanese
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" data-flag="{% static 'home/images/Spanish.png' %}" data-lang="Spanish">
                        <img src="{% static 'home/images/Spanish.png' %}" width="50" height="40" style="border-radius: 5px;">
                        Spanish
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" data-flag="{% static 'home/images/turkish.png' %}" data-lang="Turkish">
                        <img src="{% static 'home/images/turkish.png' %}" width="50" height="40" style="border-radius: 5px;">
                        Turkish
                    </a>
                </li>
            </ul>
        </div>

        <!-- JavaScript to Update Flag Image -->
        <script>
            document.addEventListener("DOMContentLoaded", function () 
            {
                // Select all dropdown items
                const languageOptions = document.querySelectorAll('.dropdown-menu .dropdown-item');
                const currentFlag = document.getElementById('currentFlag');

                // Add click event to each language option
                languageOptions.forEach(option => {
                    option.addEventListener('click', function (event) {
                        event.preventDefault(); // Prevent link from navigating

                        // Get the new flag image from the data attribute
                        const newFlagSrc = this.getAttribute('data-flag');
                        const selectedLang = this.getAttribute('data-lang');

                        // Update the main flag image
                        currentFlag.src = newFlagSrc;

                        // Optionally, log or use the selected language if needed
                        console.log("Selected Language:", selectedLang);
                    });
                });
            });
        </script>


            <!-- Difficulty dropdown -->
            <div class="dropdown ms-1">
                <a class="btn btn-light dropdown-toggle" href="#" role="button" id="dropdownMenuLink1"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    Difficulty
                </a>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink1">
                    <li><a class="dropdown-item" href="#" onclick="selectDifficulty('Easy')">Easy</a></li>
                    <li><a class="dropdown-item" href="#" onclick="selectDifficulty('Medium')">Medium</a></li>
                    <li><a class="dropdown-item" href="#" onclick="selectDifficulty('Hard')">Hard</a></li>
                </ul>
            </div>

            <!-- Generate Quiz Button -->
            <div id="generate-quiz-btn" style="display: none;" class="ms-3">
                <form method="POST" action="{% url 'generate_quiz' %}">
                    {% csrf_token %}
                    <input type="hidden" name="difficulty" id="selectedDifficultyInput" value="">
                    <button class="btn btn-warning" type="submit">Confirm</button>
                </form>
            </div>

            <!-- Quiz Generation JS -->
            <script>
                let selectedDifficulty = null;

                function selectDifficulty(difficulty) {
                    selectedDifficulty = difficulty;

                    // Change the button text to reflect the selected difficulty
                    document.getElementById('dropdownMenuLink1').textContent = difficulty;

                    // Set the hidden input's value to the selected difficulty
                    document.getElementById('selectedDifficultyInput').value = difficulty;

                    // Show the "Generate Quiz" button
                    document.getElementById('generate-quiz-btn').style.display = 'block';
                }
            </script>


            <!-- Goal dropdown (hidden for now) -->
            <!-- To change visibility, remove 'style="display: none;'" -->
            <div class="dropdown ms-2" style="display: none;">
                <a class="btn btn-light dropdown-toggle" href="#" role="button" id="dropdownMenuLink2"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    Goal
                </a>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink2">
                    <li><a class="dropdown-item" href="#">Travel</a></li>
                    <li><a class="dropdown-item" href="#">Fluency</a></li>
                    <li><a class="dropdown-item" href="#">For Fun</a></li>
                </ul>
            </div>
        </div>

        <!-- Logo -->
        <div class="d-flex justify-content-center flex-grow-1">
            <a class="navbar-brand" href="{% url 'index' %}">
                <img src="{% static 'home/images/whiteLogo.png' %}" width="70" height="60" alt="">
            </a>
        </div>

        <!-- Word of the day -->
         <div style="display: flex; align-items: center;">
            <a href="{% url 'word_of_the_day' %}">
                <i<i class="bi bi-lightbulb" style="color:white; font-size: 1.5rem; margin-right: 20px;"></i>
            </a>
         </div>


        <!-- Profile Icon -->
        <!-- TEMPORARY: when user is logged in, clicking the person circle is how they log out -->
        <div style="display: flex; align-items: center;">
            {% if user.is_authenticated %}
            <span class="text-white" style="font-weight: bold; margin-right: 10px;">Welcome, {{ user }}</span>
            <a href="{% url 'logout' %}">
                <i class="bi bi-person-circle text-white" style="font-size: 2rem;"></i>
            </a>
            {% else %}
            <a href="{% url 'login-page' %}">
                <i class="bi bi-person-circle text-white" style="font-size: 2rem;"></i>
            </a>
            {% endif %}
        </div>
    </div>
</nav>

{% endblock navbar %}

{% block content %}
<div class="container text-center mt-5">
    <h1 class="display-4" style="color: #31393C;">Welcome to ChitChatty!</h1>
    <p class="lead" style="color: #31393C;">Your go-to platform for enhancing your language skills.</p>
</div>

<!-- Next Quiz section -->
<div class="d-flex justify-content-center align-items-center" style="height: 60vh;">
    <div class="card shadow-lg"
        style="width: 60%; padding: 30px; border: 3px solid #2176FF; border-radius: 15px; position: relative; background: #ffffff;">
        <!-- Next Quiz header -->
        <h1 class="card-title"
            style="position: absolute; top: 20px; left: 30px; font-size: 48px; color: #2176FF; font-weight: bold; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);">
            Next Quiz</h1>
        
        <!-- Streak Count Display-->
        {% if user.is_authenticated %}
            {% if member.streakCount > 0 %}
            <div style="position: absolute; bottom: 20px; right: 30px; font-size: 32px; color: #2176FF;"> 
                {{ member.streakCount }} Day Streak 
            </div>
            {% endif %}
        {% endif %}

        <div class="d-flex flex-column justify-content-center align-items-center" style="margin-top: 100px;">
            <!-- Display the quiz title and description -->
            <h4 class="text-primary mt-4"
                style="font-size: 32px; color: #33A1FD; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);">{{ quiz_title }}
            </h4>
            <p class="card-text mb-4" style="color: #31393C; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);">{{ quiz_description }}</p>

            <!-- Play Button -->
            {% if quiz_available %}
            <!-- Active play button if quiz is available -->
            <a href="{% url 'quiz' %}" class="btn play-btn rounded-circle d-flex justify-content-center align-items-center active"
                style="background: #FDCA40; border: none;">
                <i class="bi bi-play-fill" style="font-size: 60px; color: white; margin-left: 5px;"></i>
            </a>
            {% else %}
            <!-- Disabled play button if no quiz is available -->
            <button class="btn rounded-circle d-flex justify-content-center align-items-center"
                style="width: 120px; height: 120px; background: gray; border: none; box-shadow: 6px 6px 14px rgba(0, 0, 0, 0.3); transition: all 0.3s ease-in-out;" disabled>
                <i class="bi bi-play-fill" style="font-size: 60px; color: white; margin-left: 5px;"></i>
            </button>
            {% endif %}
        </div>
    </div>
</div>
{% endblock content %}

