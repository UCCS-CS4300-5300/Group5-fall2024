{% extends "home/base_template.html" %}
{% load static %}


{% block splashscreen %}
<div id="splash" class="splash-screen">
    <h1 class="splash-logo">ChitChatty ٩( ᐛ)و</h1>
</div>

<!-- JavaScript to hide the splash screen after a delay -->
<script>
    window.addEventListener("load", function () {
        setTimeout(function () {
            // Start the fade-out effect by adding the splash-hidden class
            const splash = document.getElementById("splash");
            const logo = document.querySelector(".splash-logo");
            splash.classList.add("splash-hidden");

            // Grow and fade out the logo
            logo.style.transform = "scale(1.2)"; // Grow effect
            setTimeout(function () {
                splash.style.display = "none"; // Remove splash screen
            }, 1000); // Delay matches the splash fade-out duration
        }, 1000);  // Delay before starting the splash screen fade-out (1000ms = 1 second)
    });
</script>
{% endblock splashscreen %}

{% block navbar %}
<!-- Navbar Content -->
<nav class="navbar navbar-light floating-navbar" id="navbar" data-authenticated="{{ user.is_authenticated }}">
    <div class="container-fluid d-flex justify-content-between align-items-center">

        <!-- Left Hand Side -->
        <div class="d-flex align-items-center">

            <!-- Moved flag dropdown to it's own template -->
            {% include 'home/partials/language_selection.html' %}
            
            <!-- Goal dropdown (hidden for now) -->
            <!-- To change visibility, remove 'style="display: none;'" -->
            <div class="dropdown ms-2" style="display: none;">
                <a class="btn btn-light dropdown-toggle" href="#" role="button" id="dropdownMenuLink6"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    Goal
                </a>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink2">
                    <li><a class="dropdown-item" href="#">Travel</a></li>
                    <li><a class="dropdown-item" href="#">Fluency</a></li>
                    <li><a class="dropdown-item" href="#">For Fun</a></li>
                </ul>
            </div>
        </div>

        <!-- Logo -->
        <div class="d-flex justify-content-center flex-grow-1">
            <a class="navbar-brand" href="{% url 'index' %}">
                <img src="{% static 'home/images/whiteLogo.png' %}" width="70" height="60" alt="">
            </a>
        </div>

        <!-- Word of the day -->
         <div style="display: flex; align-items: center;">
            <a href="{% url 'word_of_the_day' %}">
                <i<i class="bi bi-lightbulb" style="color:white; font-size: 1.5rem; margin-right: 20px;"></i>
            </a>
         </div>

        <!-- Profile Icon -->
        <div style="display: flex; align-items: center;">
            {% if user.is_authenticated %}    
                <!-- Dropdown menu stuff -->
                <div class="dropdown">
                    <!-- Toggle button for the dropdown menu -->
                    <a class="d-flex align-items-center" id="accountDropdownOptions" role="button" data-bs-toggle="dropdown" aria-expanded="false" 
                        style="border: 3px solid white; border-radius: 15px; padding: 5px;">
                        <!-- Profile Icon -->
                        <i class="bi bi-person-circle text-white" style="font-size: 2rem; margin-right: 10px;"></i>
                        <!-- Username -->
                        <span class="text-white" style="font-weight: bold; margin-right: 10px;">{{ user }}</span>
                        <!-- Chevron Icon -->
                        <i class="bi bi-chevron-down text-white"></i>
                    </a>
                    <!-- The dropdown menu -->
                    <ul class="dropdown-menu" aria-labelledby="accountDropdownOptions" style="margin-top: 5px;">
                        <!-- Profile Option -->
                        <li>
                            <a class="dropdown-item" href="{% url 'account_details' user.id %}">
                                <i class="bi bi-person me-2"></i> Profile
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <!-- Logout Option -->
                        <li>
                            <a class="dropdown-item" href="{% url 'logout' %}">
                                <i class="bi bi-box-arrow-right me-2"></i> Logout
                            </a>
                        </li>
                    </ul>
                </div>
            {% else %}
                <!-- Login Icon for Unauthenticated Users -->
                <a href="{% url 'login-page' %}">
                    <i class="bi bi-person-circle text-white" style="font-size: 2rem;"></i>
                </a>
            {% endif %}
        </div>
    </div>
</nav>

{% endblock navbar %}

{% block content %}
<div class="container text-center mt-5">
    <h1 class="display-4" style="color: #31393C;">Welcome to ChitChatty!</h1>
    <p class="lead" style="color: #31393C;">Your go-to platform for enhancing your language skills.</p>
</div>

<!-- Quiz Section -->
<div class="d-flex justify-content-center align-items-center" style="height: 60vh;">
    <div class="card shadow-lg"
        style="width: 60%; padding: 30px; border: 3px solid #2176FF; border-radius: 15px; background: #ffffff;">


        <!-- Create a Quiz header -->
        {% if active_quiz %}
            <!-- Section for continuing an existing quiz -->
            <div class="card-body d-flex flex-column justify-content-between" style="margin-top: 100px;">
                <h1 class="card-title" style="position: absolute; top: 20px; left: 30px; font-size: 48px; color: #2176FF; font-weight: bold; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);">
                    Continue Quiz
                </h1>
                {% if user.is_authenticated %}
                    <div class="card-body d-flex justify-content-between">
                        <!-- Form for creating a new quiz with play button -->
                        <form method="POST" action="{% url 'continue_quiz' %}">
                            {% csrf_token %}
                            <input type="hidden" name="difficulty" id="selectedDifficultyInput" value="">
                            <input type="hidden" name="num_questions" id="selectedLengthInput" value="">
                            <input type="hidden" name="learning_goal" id="selectedGoalInput" value="">
                            <button type="submit" class="btn play-btn rounded-circle d-flex justify-content-center align-items-center" style="background: #FDCA40; border: none; width: 120px; height: 120px;">
                                <i class="bi bi-play-fill" style="font-size: 60px; color: white; margin-left: 5px;"></i>
                            </button>
                        </form>
                {% else %}
                    <p>Please <a href="{% url 'login-page' %}">log in</a> to create a quiz.</p>
                {% endif %}
        {% else %}
            <!-- "Create a Quiz" section if no saved quiz exists -->
            <div class="card-body d-flex flex-column justify-content-between" style="margin-top: 100px;">
                <h1 class="card-title" style="position: absolute; top: 20px; left: 30px; font-size: 48px; color: #2176FF; font-weight: bold; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);">
                    Create a Quiz
                </h1>
                {% if user.is_authenticated %}
                    <div class="card-body d-flex justify-content-between">
                        <!-- Form for creating a new quiz with play button -->
                        <form method="POST" action="{% url 'generate_quiz' %}">
                            {% csrf_token %}
                            <input type="hidden" name="difficulty" id="selectedDifficultyInput" value="">
                            <input type="hidden" name="num_questions" id="selectedLengthInput" value="">
                            <input type="hidden" name="learning_goal" id="selectedGoalInput" value="">
                            <button type="submit" class="btn play-btn rounded-circle d-flex justify-content-center align-items-center" style="background: #FDCA40; border: none; width: 120px; height: 120px;">
                                <i class="bi bi-play-fill" style="font-size: 60px; color: white; margin-left: 5px;"></i>
                            </button>
                        </form>

                        <!-- Dropdowns for quiz parameters -->
                        <div class="d-flex flex-column align-items-end">
                            <div class="dropdown ms-1">
                                <a class="btn btn-warning dropdown-toggle" href="#" role="button" id="dropdownMenuLink1" data-bs-toggle="dropdown" aria-expanded="false">
                                    Difficulty of Questions
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink1">
                                    <li><a class="dropdown-item" href="#" onclick="selectDifficulty('Easy')">Easy</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="selectDifficulty('Medium')">Medium</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="selectDifficulty('Hard')">Hard</a></li>
                                </ul>
                            </div>

                            <div class="dropdown ms-1">
                                <a class="btn btn-warning dropdown-toggle" href="#" role="button" id="dropdownMenuLink2" data-bs-toggle="dropdown" aria-expanded="false">
                                    Number of Questions
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink2">
                                    <li><a class="dropdown-item" href="#" onclick="selectLength(5)">5</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="selectLength(10)">10</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="selectLength(15)">15</a></li>
                                </ul>
                            </div>

                            <div class="dropdown ms-1">
                                <a class="btn btn-warning dropdown-toggle" href="#" role="button" id="dropdownMenuLink3" data-bs-toggle="dropdown" aria-expanded="false">
                                    Learning Goal of the Quiz
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink3">
                                    <li><a class="dropdown-item" href="#" onclick="selectGoal('Travel')">Travel</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="selectGoal('Fluency')">Fluency</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="selectGoal('For Fun')">For Fun</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <p>Please <a href="{% url 'login-page' %}">log in</a> to create a quiz.</p>
                {% endif %}
            </div>
        {% endif %}

    </div>
</div>

<script>
    function selectDifficulty(difficulty) {
        document.getElementById('dropdownMenuLink1').textContent = difficulty;
        document.getElementById('selectedDifficultyInput').value = difficulty;
    }

    function selectLength(length) {
        document.getElementById('dropdownMenuLink2').textContent = length;
        document.getElementById('selectedLengthInput').value = length;
    }

    function selectGoal(goal) {
        document.getElementById('dropdownMenuLink3').textContent = goal;
        document.getElementById('selectedGoalInput').value = goal;
    }

    document.addEventListener("DOMContentLoaded", function () {
    // Set default dropdown values based on session
    const difficulty = "{{ request.session.selected_difficulty|default:'' }}";
    const length = "{{ request.session.selected_length|default:'' }}";
    const goal = "{{ request.session.selected_goal|default:'' }}";

    if (difficulty) document.getElementById('dropdownMenuLink1').textContent = difficulty;
    if (length) document.getElementById('dropdownMenuLink2').textContent = length;
    if (goal) document.getElementById('dropdownMenuLink3').textContent = goal;

    // Ensure flag remains visible
    const selectedLanguage = "{{ request.session.selected_language|default:'chinese' }}";
    document.getElementById('currentFlag').src = "{% static 'home/images/' %}" + selectedLanguage + ".png";
});

</script>
{% endblock content %}
