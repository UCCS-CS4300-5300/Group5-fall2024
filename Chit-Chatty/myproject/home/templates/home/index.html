{% extends "home/base_template.html" %}
{% load static %}


{% block splashscreen %}
<div id="splash" class="splash-screen">
    <h1 class="splash-logo">ChitChatty ٩( ᐛ)و</h1>
</div>

<!-- JavaScript to hide the splash screen after a delay -->
<script>
    window.addEventListener("load", function () {
        setTimeout(function () {
            // Start the fade-out effect by adding the splash-hidden class
            const splash = document.getElementById("splash");
            const logo = document.querySelector(".splash-logo");
            splash.classList.add("splash-hidden");

            // Grow and fade out the logo
            logo.style.transform = "scale(1.2)"; // Grow effect
            setTimeout(function () {
                splash.style.display = "none"; // Remove splash screen
            }, 1000); // Delay matches the splash fade-out duration
        }, 1000);  // Delay before starting the splash screen fade-out (1000ms = 1 second)
    });
</script>
{% endblock splashscreen %}

{% block navbar %}
<!-- Navbar Content -->
<nav class="navbar navbar-light floating-navbar" id="navbar" data-authenticated="{{ user.is_authenticated }}">
    <div class="container-fluid d-flex justify-content-between align-items-center">

        <!-- Left Hand Side -->
        <div class="d-flex align-items-center">

        <!-- Flag Dropdown -->
        <div class="dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <!-- Add ID to target the main flag image -->
                <img id="currentFlag" src="{% static 'home/images/' %}{{ request.session.selected_language|default:'chinese'|lower }}.png" width="55" height="45" alt="Current flag" style="border-radius: 10px;">
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <li>
                    <a class="dropdown-item" href="#" data-flag="{% static 'home/images/chinese.png' %}" data-lang="Chinese">
                        <img src="{% static 'home/images/chinese.png' %}" width="50" height="40" style="border-radius: 5px;">
                        Chinese
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" data-flag="{% static 'home/images/netherlands.png' %}" data-lang="Dutch">
                        <img src="{% static 'home/images/netherlands.png' %}" width="50" height="40" style="border-radius: 5px;">
                        Dutch
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" data-flag="{% static 'home/images/french.png' %}" data-lang="French">
                        <img src="{% static 'home/images/french.png' %}" width="50" height="40" style="border-radius: 5px;">
                        French
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" data-flag="{% static 'home/images/japanese.png' %}" data-lang="Japanese">
                        <img src="{% static 'home/images/japanese.png' %}" width="50" height="40" style="border-radius: 5px;">
                        Japanese
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" data-flag="{% static 'home/images/Spanish.png' %}" data-lang="Spanish">
                        <img src="{% static 'home/images/Spanish.png' %}" width="50" height="40" style="border-radius: 5px;">
                        Spanish
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" data-flag="{% static 'home/images/turkish.png' %}" data-lang="Turkish">
                        <img src="{% static 'home/images/turkish.png' %}" width="50" height="40" style="border-radius: 5px;">
                        Turkish
                    </a>
                </li>
            </ul>
        </div>

        <!-- Move these eventually!! javascript files were having a huge issue-->
        <!-- JavaScript to Update Flag Image -->
        <script>
            document.addEventListener("DOMContentLoaded", function () 
            {
                // Select all dropdown items
                const languageOptions = document.querySelectorAll('.dropdown-menu .dropdown-item');
                const currentFlag = document.getElementById('currentFlag');

                // Add click event to each language option
                languageOptions.forEach(option => {
                    option.addEventListener('click', function (event) {
                        event.preventDefault(); // Prevent link from navigating

                        // Get the new flag image from the data attribute
                        const newFlagSrc = this.getAttribute('data-flag');
                        const selectedLang = this.getAttribute('data-lang');

                        // Update the main flag image
                        currentFlag.src = newFlagSrc;

                        // Optionally, log or use the selected language if needed
                        console.log("Selected Language:", selectedLang);
                    });
                });
            });
        </script>

        <!-- JavaScript to store language selection -->
        <script>
            document.addEventListener("DOMContentLoaded", function () 
            {
                const languageOptions = document.querySelectorAll('.dropdown-menu .dropdown-item');
                const currentFlag = document.getElementById('currentFlag');

                languageOptions.forEach(option => {
                    option.addEventListener('click', function (event) {
                        event.preventDefault();

                        const newFlagSrc = this.getAttribute('data-flag');
                        const selectedLang = this.getAttribute('data-lang');

                        currentFlag.src = newFlagSrc;

                        // Send an AJAX request to save the selected language in the session
                        fetch("{% url 'set_language' %}", {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': '{{ csrf_token }}'
                            },
                            body: JSON.stringify({ language: selectedLang.toLowerCase() })
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            console.log("Language saved:", selectedLang);
                        })
                        .catch(error => console.error('Error:', error));
                    });
                });
            });
        </script>
            
            <!-- Goal dropdown (hidden for now) -->
            <!-- To change visibility, remove 'style="display: none;'" -->
            <div class="dropdown ms-2" style="display: none;">
                <a class="btn btn-light dropdown-toggle" href="#" role="button" id="dropdownMenuLink6"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    Goal
                </a>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink2">
                    <li><a class="dropdown-item" href="#">Travel</a></li>
                    <li><a class="dropdown-item" href="#">Fluency</a></li>
                    <li><a class="dropdown-item" href="#">For Fun</a></li>
                </ul>
            </div>
        </div>

        <!-- Logo -->
        <div class="d-flex justify-content-center flex-grow-1">
            <a class="navbar-brand" href="{% url 'index' %}">
                <img src="{% static 'home/images/whiteLogo.png' %}" width="70" height="60" alt="">
            </a>
        </div>

        <!-- Word of the day -->
         <div style="display: flex; align-items: center;">
            <a href="{% url 'word_of_the_day' %}">
                <i<i class="bi bi-lightbulb" style="color:white; font-size: 1.5rem; margin-right: 20px;"></i>
            </a>
         </div>


        <!-- Profile Icon -->
        <!-- TEMPORARY: when user is logged in, clicking the person circle is how they log out -->
        <div style="display: flex; align-items: center;">
            {% if user.is_authenticated %}
            <span class="text-white" style="font-weight: bold; margin-right: 10px;">Welcome, {{ user }}</span>
            <a href="{% url 'logout' %}">
                <i class="bi bi-person-circle text-white" style="font-size: 2rem;"></i>
            </a>
            {% else %}
            <a href="{% url 'login-page' %}">
                <i class="bi bi-person-circle text-white" style="font-size: 2rem;"></i>
            </a>
            {% endif %}
        </div>
    </div>
</nav>

{% endblock navbar %}

{% block content %}
<div class="container text-center mt-5">
    <h1 class="display-4" style="color: #31393C;">Welcome to ChitChatty!</h1>
    <p class="lead" style="color: #31393C;">Your go-to platform for enhancing your language skills.</p>
</div>
<!-- Quiz Section -->
<div class="d-flex justify-content-center align-items-center" style="height: 60vh;">
    <div class="card shadow-lg"
        style="width: 60%; padding: 30px; border: 3px solid #2176FF; border-radius: 15px; position: relative; background: #ffffff;">

        <div class="card-body d-flex flex-column justify-content-between" style="margin-top: 100px;"></div>
            <!-- Create a Quiz header -->
            <h1 class="card-title"
                style="position: absolute; top: 20px; left: 30px; font-size: 48px; color: #2176FF; font-weight: bold; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);">
                Create a Quiz
            </h1>

            <div class="card-body d-flex justify-content-between">
                <!-- Play Button -->
                <form method="POST" action="{% url 'generate_quiz' %}">
                    {% csrf_token %}
                    <input type="hidden" name="difficulty" id="selectedDifficultyInput" value="">
                    <input type="hidden" name="num_questions" id="selectedLengthInput" value="">
                    <input type="hidden" name="learning_goal" id="selectedGoalInput" value="">
                    <button type="submit" class="btn play-btn rounded-circle d-flex justify-content-center align-items-center"
                        style="background: #FDCA40; border: none; width: 120px; height: 120px;">
                        <i class="bi bi-play-fill" style="font-size: 60px; color: white; margin-left: 5px;"></i>
                    </button>
                </form>

                <div class="d-flex flex-column align-items-end">
                    <!-- Difficulty Dropdown -->
                    <div class="dropdown ms-1">
                        <a class="btn btn-warning dropdown-toggle" href="#" role="button" id="dropdownMenuLink1"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Difficulty of Questions
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink1">
                            <li><a class="dropdown-item" href="#" onclick="selectDifficulty('Easy')">Easy</a></li>
                            <li><a class="dropdown-item" href="#" onclick="selectDifficulty('Medium')">Medium</a></li>
                            <li><a class="dropdown-item" href="#" onclick="selectDifficulty('Hard')">Hard</a></li>
                        </ul>
                    </div>

                    <p></p>

                    <!-- Number of Questions Dropdown -->
                    <div class="dropdown ms-1">
                        <a class="btn btn-warning dropdown-toggle" href="#" role="button" id="dropdownMenuLink2"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Number of Questions
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink2">
                            <li><a class="dropdown-item" href="#" onclick="selectLength(5)">5</a></li>
                            <li><a class="dropdown-item" href="#" onclick="selectLength(10)">10</a></li>
                            <li><a class="dropdown-item" href="#" onclick="selectLength(15)">15</a></li>
                        </ul>
                    </div>

                    <p></p>

                    <!-- Learning Goal Dropdown -->
                    <div class="dropdown ms-1">
                        <a class="btn btn-warning dropdown-toggle" href="#" role="button" id="dropdownMenuLink3"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Learning Goal of the Quiz
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink3">
                            <li><a class="dropdown-item" href="#" onclick="selectGoal('Travel')">Travel</a></li>
                            <li><a class="dropdown-item" href="#" onclick="selectGoal('Fluency')">Fluency</a></li>
                            <li><a class="dropdown-item" href="#" onclick="selectGoal('For Fun')">For Fun</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function selectDifficulty(difficulty) {
        document.getElementById('dropdownMenuLink1').textContent = difficulty;
        document.getElementById('selectedDifficultyInput').value = difficulty;
    }

    function selectLength(length) {
        document.getElementById('dropdownMenuLink2').textContent = length;
        document.getElementById('selectedLengthInput').value = length;
    }

    function selectGoal(goal) {
        document.getElementById('dropdownMenuLink3').textContent = goal;
        document.getElementById('selectedGoalInput').value = goal;
    }

    document.addEventListener("DOMContentLoaded", function () {
    // Set default dropdown values based on session
    const difficulty = "{{ request.session.selected_difficulty|default:'' }}";
    const length = "{{ request.session.selected_length|default:'' }}";
    const goal = "{{ request.session.selected_goal|default:'' }}";

    if (difficulty) document.getElementById('dropdownMenuLink1').textContent = difficulty;
    if (length) document.getElementById('dropdownMenuLink2').textContent = length;
    if (goal) document.getElementById('dropdownMenuLink3').textContent = goal;

    // Ensure flag remains visible
    const selectedLanguage = "{{ request.session.selected_language|default:'chinese' }}";
    document.getElementById('currentFlag').src = "{% static 'home/images/' %}" + selectedLanguage + ".png";
});

</script>
{% endblock content %}
